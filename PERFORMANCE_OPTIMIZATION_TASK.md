# Performance Optimization Task List

## 总体目标

对整个 mdit-plugins 项目进行系统性性能优化，重点关注字符串比较、字符访问等高频操作的优化。

## 优化策略与测试方法

### 优化策略

1. **字符访问优化**: 将 `charAt()` 和 `slice()` 替换为 `charCodeAt()` 进行字符比较
2. **减少字符串创建**: 避免创建临时字符串对象
3. **循环优化**: 优化热路径中的循环逻辑
4. **使用项目工具函数**: 优先使用 helper 包中的优化函数如 `isSpace()`
5. **逻辑优化**: 改进算法逻辑以减少不必要的计算
6. **提取常量**，放置在头部，避免局部创建开销。

### 测试方法

- **端到端性能测试**: 使用真实的 Markdown 内容测试整个插件的新旧性能
- **Before/After 对比**: 每次优化前后都运行性能测试确保改进
- **功能测试保障**: 确保所有现有测试仍然通过
- **渐进式优化**: 一个优化点一个优化点地应用，避免回退

## 当前进度

### ✅ Phase 1: tex 插件优化

**状态**: 完成

## 基准测试框架

### 测试方法

使用 vitest 进行性能基准测试，确保每次优化都能量化性能提升。

首先在 `__tests__` 目录下创建基准测试文件，命名为 `performance.bench.ts`，并在其中编写测试用例。分别比较短中长内容下修改前后的性能。

在每次修改前保留当前的插件版本到 `src-old` 目录，以便进行对比测试。

命令： 在根目录执行 `vitest bench --run <file>` 来运行基准测试。

### 测试指标

- **执行时间**: 平均执行时间和吞吐量
- **内存使用**: 堆内存分配和垃圾回收压力
- **CPU 使用率**: 处理器利用效率

### 测试数据

- 小文档: 1,000 字符
- 中等文档: 5,000 字符
- 大文档: 10,000+ 字符
- 真实文档: 实际项目中的 Markdown 文件

## 实施规则

1. **测试先行**: 每个优化都要有 before/after 基准测试
2. **渐进式优化**: 一次优化一个点，确保每次都是正向改进
3. **向后兼容**: 不破坏现有 API 和功能
4. **代码质量**: 保持代码可读性和可维护性

## 当前任务清单

### tex 插件优化任务

- [x] 创建基准测试框架
- [x] 识别主要优化点
- [x] 实施 charCodeAt 优化（完成）
- [x] 完成所有字符串比较优化
- [x] 优化 charAt → charCodeAt
- [x] 移除不必要的边界检查
- [x] 优化循环逻辑
- [x] 创建完整的 before/after 基准测试
- [x] 验证功能正确性（运行测试套件）

### 下一步行动

1. 从 A-z 完成其他插件，首先是 abbr 插件

---

**最后更新**: 2025-06-11  
**当前专注**: abbr 插件优化
